{% extends 'base.html'%} {% load static %} 

{% block title %} PDArchiver {% endblock %}

{% block content %}

<div class="homePage">
    <nav class="navbar navbar-expand-sm fixed-top" style="background-color: #064420;">
        <a class="navbar-brand" href="#"></a>
        
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="False" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="topnav-right">
                <a href="{% url 'upload' %}"><i class="fa fa-upload" style="font-size:20px" ></i>  UPLOAD  &nbsp</a>
                <a href="#"><i class="fa fa-fw fa-user" style="font-size:20px" ></i> PROFILE &nbsp</a>
                <a href="{% url 'logout' %}"><i class="fa fa-sign-out" style="font-size:20px" > </i>LOGOUT  &nbsp</a>
      
            </div>
          </div>
    </nav>
        <div id="wrap">  
        <div class="container-fluid">
            <!-- Start of landing -->
            <section class="jumbotron text-center my-1" id="search">
                <h2 class="ml15">
                    <span class="word">PROJECT</span>
                    <span class="word">DESIGN</span>
                    <span class="word">DOCUMENTS</span> <br>
                    <span class="word">COMPUTER ENGINEERING</span>
                  </h2>
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.0.2/anime.min.js"></script>
                
                <div class="container-fluid col-6">
                    <!-- Search -->
                    <form id="search_form" class="d-flex" role="search" method="POST" action="#" placeholder="SEARCH">
                        {% csrf_token %}
                        {{form}}
                    </form>
                </div>
                
            </section>
            
            <section class="p-1  my-1" id="content">
                
                <div class=" container-d-flex m-9 p-5" >
                    <div class="row justify-content-around">
                        
                                <div class="p-3 border col-3  bg-light">

                            <!-- Table of content -->
                            <div id="simple-list-example" class="d-flex flex-column gap-2 simple-list-example-scrollspy text-left">
                                <h5>CATEGORIES</h5>
                                {% for thesis in thesis %}
                                    {% for tags in thesis.tags.all %}
                                        <label>
                                            <input class="filter-checkbox" type="checkbox" data-filter="category" value="{{tags.name}}"/>
                                            <span class="span-checkbox-font" style="font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif !important;
                                            font-size: 10pt !important;
                                            color: black;">Agriculture</span>
                                        </label>
                                        <label>
                                            <input class="filter-checkbox" type="checkbox" data-filter="category" value="{{tags.name}}" />
                                            <span style="font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif !important;
                                            font-size: 10pt !important;
                                            color: black;">Medical Technology</span>
                                        </label>
                                        <label>
                                            <input class="filter-checkbox" type="checkbox" data-filter="category" value="{{tags.name}}" />
                                            <span style="font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif !important;
                                            font-size: 10pt !important;
                                            color: black;">Machine Learning</span>
                                        </label>
                                        <label>
                                            <input class="filter-checkbox" type="checkbox" data-filter="category" value="{{tags.name}}" />
                                            <span style="font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif !important;
                                            font-size: 10pt !important;
                                            color: black;">Deep Learning</span>
                                        </label>
                                        <label>
                                            <input class="filter-checkbox" type="checkbox" data-filter="category" value="{{tags.name}}" />
                                            <span style="font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif !important;
                                            font-size: 10pt !important;
                                            color: black;">Artificial Intelligence</span>
                                        </label>
                                        <label>
                                            <input class="filter-checkbox" type="checkbox" data-filter="category" value="{{tags.name}}" />
                                            <span style="font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif !important;
                                            font-size: 10pt !important;
                                            color: black;">Education</span>
                                        </label>
                                        <label>
                                            <input class="filter-checkbox" type="checkbox" data-filter="category" value="{{tags.name}}" />
                                            <span style="font-family: 'Helvetica Neue',Helvetica,Arial,sans-serif !important;
                                            font-size: 10pt !important;
                                            color: black;">Environment</span>
                                        </label>
                                    {% endfor %}
                                {% endfor %}
                            </div>
                        </div>
                        <div class="col-xl-8 offset-lg-1 py-1 bg-light">
                            <!--pagination-->
                            <div class="">
                            <!-- list of researches -->
                            <div data-bs-spy="scroll" data-bs-target="#navbar-example3" data-bs-smooth-scroll="true" class="scrollspy-example-2" tabindex="0">
                                

                                <div id="result_box" class="list-group">

                                    {% for thesis in thesis %}
                                    
                                    <a href="{% url 'abstract' thesis.slug %}" class="list-group-item list-group-item-action"  >
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1" style="font-weight: bold;">{{thesis.title}}</h5>
                                        <small>{{thesis.whenpublished}}</small>
                                    </div>
                                    <div class="abstract_desc" style="height: 10em; overflow: hidden;">
                                        <p class="mb-1">{{thesis.abstract}}</p>
                                    </div>
                                        {% for authors in thesis.authors.all %}
                                            <small>{{authors.detailName}},</small>
                                        {% endfor %} <br />
                                        {% for tags in thesis.tags.all %}
                                            <small>{{tags.name}},</small>
                                    {% endfor %}
                                    {% endfor %}
                                    
                                    </a>
                                    
                                </div>
                            </div>
                            <ul class="pagination justify-content-center align-items-center">
                                <li class="page-item disabled">
                                    <a class="page-link" href="#" aria-label="Previous">
                                        <span aria-hidden="true">«</span>
                                        <span class="sr-only">Previous</span>
                                    </a>
                                </li>
                                <li class="page-item active">
                                    <a class="page-link" href="#">1</a>
                                </li>
                                <li class="page-item"><a class="page-link" href="#">2</a></li>
                                <li class="page-item"><a class="page-link" href="#">3</a></li>
                                <li class="page-item"><a class="page-link" href="#">4</a></li>
                                <li class="page-item">
                                    <a class="page-link" href="#" aria-label="Next">
                                        <span aria-hidden="true">»</span>
                                        <span class="sr-only">Next</span>
                                    </a>
                                </li>
                            </ul>
                        </div>
                            </div>
                            
                        </div>
                        </div>
                    </div>
                </div>
           
        </div>
        <!-- end of container for our layout -->
        {% if messages %} {% for message in messages %}
        <p>{{message}}</p>
        {% endfor %} {% endif %}
</div>

{% endblock %}
{% block script %}
<script>
    const result_box = document.querySelector('#result_box');

    const sendSearchData = (thesis) => {

        $.ajax ({
            type: 'POST',
            url: '{% url 'search' %}',
            data : {
                'thesis': thesis
            },
            headers: {"X-CSRFToken" : csrf_token},

            success : (res) => {
                const data = res.data;
                console.log(data)
                if(Array.isArray(data)) {
                    data.forEach(thesis => {
                        result_box.innerHTML += `
                            <a href="/search/abstract/${thesis.slug}" class="list-group-item list-group-item-action" >
                            <div class="d-flex w-100 justify-content-between">
                                <h5 class="mb-1" style="font-weight: bold;">${thesis.title}</h5>
                                <small>${thesis.whenpublished}</small>
                            </div>
                            <div class="abstract_desc" style="height: 10em; overflow: hidden;">
                                <p class="mb-1">${thesis.abstract}}</p>
                            </div>
                            ${thesis.authors.map((e) => `<small>${e.fullName}</small>`)}
                            <br />
                            ${thesis.tags.map((e) => ` <small>${e}</small>`)}
                        `
                            
                    })
                } else {
                    if(search_field.value.length > 0) {
                        result_box.innerHTML = `<b>${data}</b>`;
                    } else {
                        result_box.innerHTML = `
                        {% for thesis in theses %}
                                    
                                    <a href="#" class="list-group-item list-group-item-action" >
                                    <div class="d-flex w-100 justify-content-between">
                                        <h5 class="mb-1">{{thesis.title}}</h5>
                                        <small>{{thesis.whenpublished}}</small>
                                    </div>
                                    <p class="mb-1">{{thesis.abstract}}</p>
                                        {% for authors in thesis.authors.all %}
                                            <small>{{authors.detailName}}</small>
                                        {% endfor %}
                                    {% endfor %}`
                    }
                }
            },
            err : (err) => {
                console.log(err);
            }
        })
    }
    
    const search_form = document.querySelector('#search_form');
    const search_field = document.querySelector('[name="searchField"]');
    const csrf_token = document.querySelector('[name="csrfmiddlewaretoken"]').value;
    

    search_field.addEventListener('keyup', (e) => {

        result_box.innerHTML = "";

      

        sendSearchData(e.target.value);  
        
        
    })

    anime.timeline({loop: true})
    .add({
      targets: '.ml15 .word',
      scale: [14,1],
      opacity: [0,1],
      easing: "easeOutCirc",
      duration: 800,
      delay: (el, i) => 800 * i
    }).add({
      targets: '.ml15',
      opacity: 0,
      duration: 1000,
      easing: "easeOutExpo",
      delay: 1000
    });

   
$(document).ready(function() {
    $('.filter-checkbox').on('click', function() {
        let _filterObj = {};
        $('.filter-checkbox').each(function(index, elm) {
            let _filterVal = $(this).val();
            let _filterKey = $(this).data('filter');
            _filterObj[_filterKey] = Array.from(document.querySelectorAll('input[data-filter='+_filterKey+']:checked')
            ).map(function(el){
                console.log(el.value);
            })
        })
    });
    
})


</script>
{% endblock %}
